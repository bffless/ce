# ============================================================================
# ENVIRONMENT CONFIGURATION
# ============================================================================
#
# This file contains all configuration options for the Asset Host platform.
# Copy this file to .env and update values for your environment.
#
# Legend:
#   [REQUIRED]  - Must be set before running
#   [OPTIONAL]  - Has sensible defaults, customize as needed
#   [PROD-ONLY] - Only needed for production deployments
#
# ============================================================================


# ============================================================================
# 1. SECURITY KEYS [REQUIRED]
# ============================================================================
# CRITICAL: These keys protect your data. Generate unique values for each.
#
# ┌─────────────────────────────────────────────────────────────────────────┐
# │ QUICK SETUP - Run these commands to generate all keys:                  │
# │                                                                         │
# │   # Generate and append to .env file:                                   │
# │   echo "ENCRYPTION_KEY=$(openssl rand -base64 32)" >> .env              │
# │   echo "JWT_SECRET=$(openssl rand -base64 32)" >> .env                  │
# │   echo "API_KEY_SALT=$(openssl rand -base64 32)" >> .env                │
# │                                                                         │
# │   # Or generate individually and copy/paste:                            │
# │   openssl rand -base64 32                                               │
# │                                                                         │
# │   # Alternative using Node.js:                                          │
# │   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))" │
# └─────────────────────────────────────────────────────────────────────────┘
#
# WARNING: ENCRYPTION_KEY must NEVER be changed after initial setup!
#          It encrypts storage credentials in the database.
#          Back it up securely - if lost, you must reconfigure all storage.
# ----------------------------------------------------------------------------

# AES-256 key for encrypting storage credentials (MinIO/S3 keys, etc.) in database
# REQUIRED: Must be set before first run
# If you lose or change this key, you will lose access to storage config!
ENCRYPTION_KEY=

# JWT signing secret for authentication tokens
# OPTIONAL: Auto-generated during setup wizard if not provided
# Set manually for multi-instance deployments sharing the same database
JWT_SECRET=

# Salt for hashing API keys before storage
# OPTIONAL: Auto-generated during setup wizard if not provided
# Set manually for multi-instance deployments sharing the same database
API_KEY_SALT=

# Onboarding token for secure workspace setup
# OPTIONAL: Restricts who can create the initial admin account
# If set, the setup wizard will require this token in the URL:
#   http://localhost/setup?token=<your-token>
# Generate with: openssl rand -hex 32
# Recommended for public-facing deployments to prevent unauthorized setup
# ONBOARDING_TOKEN=


# ============================================================================
# 2. DATABASE [REQUIRED]
# ============================================================================
# PostgreSQL database configuration
#
# Option 1: Docker PostgreSQL (default, recommended for most users)
#   - Leave ENABLE_POSTGRES unset or set to 'true'
#   - Docker will start a PostgreSQL container automatically
#   - Configure credentials below (used by Docker)
#
# Option 2: External PostgreSQL (advanced)
#   - Set ENABLE_POSTGRES=false
#   - Set DATABASE_URL to your external PostgreSQL connection string
#   - Docker PostgreSQL container will NOT start
#   - Saves ~256MB RAM
#
# IMPORTANT: This must be configured BEFORE first run. Unlike storage and
# email providers, PostgreSQL cannot be configured via the onboarding UI
# because the database must exist before the application can start.
# ----------------------------------------------------------------------------

# Set to 'false' to use external PostgreSQL (default: true)
# ENABLE_POSTGRES=false

# PostgreSQL password for Docker container (change from default in production!)
POSTGRES_PASSWORD=changeme

# Full connection string
# - For Docker PostgreSQL (default): uses POSTGRES_PASSWORD above
# - For External PostgreSQL: set full connection string with external host
#
# Examples:
#   Docker (default):   postgresql://postgres:changeme@postgres:5432/assethost
#   AWS RDS:            postgresql://user:pass@mydb.region.rds.amazonaws.com:5432/assethost
#   Google Cloud SQL:   postgresql://user:pass@/assethost?host=/cloudsql/project:region:instance
#   Azure:              postgresql://user:pass@server.postgres.database.azure.com:5432/assethost?sslmode=require
#   DigitalOcean:       postgresql://user:pass@db-host-do-user-xxx.db.ondigitalocean.com:25060/assethost?sslmode=require
#
# IMPORTANT: Always wrap DATABASE_URL in quotes if it contains special characters
# like & (common in cloud connection strings with sslmode=require&...).
# Without quotes, bash interprets & as a background command operator.
#
# Example: DATABASE_URL="postgresql://user:pass@host:5432/db?sslmode=require&option=value"
#
# DATABASE_URL=postgresql://postgres:changeme@postgres:5432/assethost

# Database connection pool size (default: 5)
# Managed databases have connection limits - adjust based on your plan:
#   DigitalOcean $13/mo: 22 total (recommend 3-5 for app)
#   DigitalOcean $24/mo: 47 total (recommend 5-10 for app)
# Note: The database provider uses ~10-15 connections for internal processes
# DB_POOL_SIZE=5


# ============================================================================
# 3. AUTHENTICATION [REQUIRED for Docker]
# ============================================================================
# SuperTokens handles user sessions and authentication
#
# IMPORTANT: SuperTokens uses a SEPARATE database from app data.
# The 'assethost' database is created by POSTGRES_DB env var.
# The 'supertokens' database is created by init-databases.sql script.
# ----------------------------------------------------------------------------

# SuperTokens Mode
# - local: Local SuperTokens with local database (default for CE standalone)
#          Requires --profile supertokens when starting Docker
# - platform: Shared SuperTokens with tenant isolation (PaaS deployment)
#             No local SuperTokens container needed
SUPERTOKENS_MODE=local

# SuperTokens server URL
# Docker production: http://supertokens:3567 (container network)
# Local dev with Docker services: leave empty (defaults to http://localhost:3567)
# Platform mode: URL of shared SuperTokens instance (e.g., http://platform-supertokens:3567)
#
# Note: For local dev (pnpm dev:full), the backend code defaults to
#       http://localhost:3567 when this is empty, which connects to the
#       SuperTokens container exposed on localhost.
SUPERTOKENS_CONNECTION_URI=http://supertokens:3567

# Optional API key for SuperTokens (adds extra security layer)
# Required for platform mode to authenticate with shared SuperTokens
SUPERTOKENS_API_KEY=

# SuperTokens Database URL (REQUIRED when ENABLE_POSTGRES=false)
# By default, SuperTokens uses the local Docker PostgreSQL container.
#
# When using external PostgreSQL (ENABLE_POSTGRES=false), you MUST set this
# to point to a separate 'supertokens' database on your external host.
# SuperTokens manages its own tables in this database automatically.
#
# IMPORTANT: Quote the value if it contains & character.
#
# Examples:
#   External host:   "postgresql://user:pass@external-host:5432/supertokens"
#   AWS RDS:         "postgresql://user:pass@mydb.region.rds.amazonaws.com:5432/supertokens"
#   With SSL:        "postgresql://user:pass@host:5432/supertokens?sslmode=require"
#
# SUPERTOKENS_DATABASE_URL=

# ============================================================================
# PLATFORM MODE CONFIGURATION
# ============================================================================
# These settings are used when deploying as part of a multi-workspace platform.
#
# SINGLE-TENANT MODE (Default):
#   - All users share the 'public' SuperTokens tenant
#   - No SuperTokens license required
#   - Simpler setup for self-hosted deployments
#   - Users can access all workspaces (shared auth)
#
# MULTI-TENANT MODE (Opt-in):
#   - Each organization gets its own SuperTokens tenant
#   - Requires SUPERTOKENS_MULTI_TENANT=true
#   - Requires SUPERTOKENS_LICENSE_KEY (paid SuperTokens feature)
#   - Users are isolated per organization
# ----------------------------------------------------------------------------

# Multi-tenant mode (opt-in)
# Set to 'true' to enable organization-based SuperTokens tenant isolation.
# Note: Multi-tenancy is a paid SuperTokens feature - configure the license key
# on the SuperTokens core server, not here.
# Leave unset or 'false' for single-tenant mode (recommended for self-hosted).
# SUPERTOKENS_MULTI_TENANT=true

# Organization ID - SuperTokens tenant (auth boundary)
# Only used when SUPERTOKENS_MULTI_TENANT=true
# All workspaces in an organization share the same user pool.
# Users can log in once and access any workspace in their organization.
# ORGANIZATION_ID=my-org

# Workspace ID (optional) - identifies this specific workspace
# Used for logging and identification. Each workspace is a separate
# CE deployment with its own database.
# WORKSPACE_ID=my-workspace

# Legacy: TENANT_ID still works (aliased to ORGANIZATION_ID)
# TENANT_ID=my-org


# ============================================================================
# 4. DOMAIN & URL CONFIGURATION [REQUIRED]
# ============================================================================
# Configure your domain names and application URLs
# ----------------------------------------------------------------------------

# Your primary domain name
# Used for: www subdomain, admin subdomain, minio subdomain, nginx config,
#           wildcard SSL certificates, and dynamic domain routing
# Examples: localhost, yourdomain.com, app.example.org
PRIMARY_DOMAIN=localhost

# Application URL (used for CORS, auth cookies, and SuperTokens configuration)
# This is the URL users use to access your application.
# Local dev: http://localhost (nginx proxies to frontend/backend)
# Production: https://www.yourdomain.com
FRONTEND_URL=http://localhost

# API Domain [OPTIONAL] - defaults to FRONTEND_URL
# Only set this if your API is served from a different domain than the frontend.
# In Docker/production with nginx, the API is proxied through the same domain,
# so you typically don't need to set this.
# API_DOMAIN=http://localhost:3000

# Admin Domain [OPTIONAL] - defaults to admin.{PRIMARY_DOMAIN}
# The domain where the admin panel is served (used for CSP frame-ancestors).
# This enables the admin panel to iframe preview content from subdomains.
# Usually you don't need to set this - it's derived from PRIMARY_DOMAIN.
# ADMIN_DOMAIN=admin.yourdomain.com


# ============================================================================
# 5. COOKIE & SESSION SETTINGS [REQUIRED]
# ============================================================================
# Configure how authentication cookies behave
# ----------------------------------------------------------------------------

# Use secure cookies (HTTPS only)
# Local development: false
# Production with HTTPS: true
COOKIE_SECURE=false

# Cookie domain for cross-subdomain authentication
# REQUIRED for production! Without this, auth cookies won't work across subdomains
# (e.g., logging in on admin.domain.com won't work on www.domain.com)
#
# Use leading dot to share cookies across all subdomains: .yourdomain.com
# Leave empty for localhost development only
# COOKIE_DOMAIN=.yourdomain.com


# ============================================================================
# 6. STORAGE CONFIGURATION [REQUIRED for Docker]
# ============================================================================
# Configure where uploaded assets are stored
# Supported types: local, minio (s3, gcs, azure planned)
# ----------------------------------------------------------------------------

# Storage backend type
# Options: local (filesystem), minio (S3-compatible)
STORAGE_TYPE=minio

# --- MinIO Configuration ---
# Only needed if STORAGE_TYPE=minio

# MinIO admin credentials (for MinIO server itself)
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=changeme

# MinIO bucket for storing assets
MINIO_BUCKET=assets

# --- MinIO Connection (backend -> MinIO) ---

# MinIO server hostname
# Docker: minio (container name)
# Local: localhost
MINIO_ENDPOINT=minio

# MinIO API port
MINIO_PORT=9000

# MinIO access credentials for backend
# Usually same as MINIO_ROOT_USER/PASSWORD
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=changeme

# Use SSL for MinIO connections
MINIO_USE_SSL=false


# ============================================================================
# 7. CACHE CONFIGURATION [OPTIONAL]
# ============================================================================
# Configure caching to reduce storage latency and costs
# ----------------------------------------------------------------------------

# Cache backend type
# Options: memory (in-process LRU), redis (distributed)
CACHE_TYPE=memory

# Redis password (auto-generated by setup.sh for production)
# Only needed if CACHE_TYPE=redis
REDIS_PASSWORD=

# ============================================================================
# 8. NGINX & REVERSE PROXY [REQUIRED for Docker]
# ============================================================================
# Configure nginx for routing and SSL termination
# ----------------------------------------------------------------------------

# Backend service connection
# Docker: backend (container name)
# Local: localhost
BACKEND_HOST=backend
BACKEND_PORT=3000

# How nginx detects config changes
NGINX_RELOAD_METHOD=file-watcher

# Path where nginx site configs are written
# Docker: /etc/nginx/sites-enabled
# Local dev: ./nginx-dev/sites-enabled
NGINX_SITES_PATH=/etc/nginx/sites-enabled

# Wait time (ms) for nginx file watcher to process changes
NGINX_RELOAD_WAIT_MS=3000


# ============================================================================
# 9. SSL CERTIFICATES [PROD-ONLY]
# ============================================================================
# Let's Encrypt SSL certificate configuration
# Only needed for production HTTPS deployments
# ----------------------------------------------------------------------------

# Path where SSL certificates are stored
# Docker: /etc/nginx/ssl
# Local dev: ./nginx-dev/ssl
SSL_CERT_PATH=/etc/nginx/ssl

# Email for Let's Encrypt notifications [REQUIRED for SSL]
# You'll receive expiry warnings and important notices
# CERTBOT_EMAIL=admin@yourdomain.com

# Webroot for ACME HTTP-01 challenges (usually don't need to change)
# CERTBOT_WEBROOT=/var/www/certbot


# ============================================================================
# 9b. CDN / REVERSE PROXY [OPTIONAL]
# ============================================================================
# Configure how nginx handles upstream proxies like Cloudflare.
# Default: none (standard Let's Encrypt / self-managed certs)
# ----------------------------------------------------------------------------

# Proxy mode
# Options:
#   none       - (default) Standard setup. HTTP redirects to HTTPS.
#                Uses Let's Encrypt or self-managed certificates.
#   cloudflare - Cloudflare CDN proxy. HTTP connections are dropped (444).
#                Uses Cloudflare Origin Certificates for origin-to-edge encryption.
#                Restores real visitor IPs from CF-Connecting-IP header.
#                Wildcard subdomains use the main Origin Cert (includes *.domain SAN).
#
# For Cloudflare setup instructions, see:
#   https://your-docs-site/self-hosting/cloudflare-cdn
# PROXY_MODE=none


# ============================================================================
# 10. EMAIL / SMTP [OPTIONAL]
# ============================================================================
# Configure email sending for password resets, notifications, etc.
# If not configured, emails are logged to console (useful for development)
# ----------------------------------------------------------------------------

# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password

# Email sender information
# EMAIL_FROM_NAME="Asset Host"
# EMAIL_FROM_ADDRESS=noreply@yourdomain.com


# ============================================================================
# 11. LOGGING [OPTIONAL]
# ============================================================================
# Configure application log verbosity
# ----------------------------------------------------------------------------

# Log level(s) - comma-separated list of enabled log levels
# Available levels (most to least verbose): verbose, debug, log, warn, error
# Default (if not set): error,warn,log
#
# Examples:
#   LOG_LEVEL=error                      # Errors only (quietest)
#   LOG_LEVEL=error,warn                 # Errors and warnings
#   LOG_LEVEL=error,warn,log             # Standard (default)
#   LOG_LEVEL=error,warn,log,debug       # Include debug output
#   LOG_LEVEL=error,warn,log,debug,verbose  # Everything (noisiest)
#
# LOG_LEVEL=error,warn,log


# ============================================================================
# 12. PRODUCTION QUICK REFERENCE [PROD-ONLY]
# ============================================================================
# Uncomment and update these settings for production deployment.
# This section is a convenience reference - the actual variables are above.
# ----------------------------------------------------------------------------

# PRIMARY_DOMAIN=yourdomain.com
# FRONTEND_URL=https://www.yourdomain.com
# ADMIN_DOMAIN=admin.yourdomain.com
# COOKIE_SECURE=true
# COOKIE_DOMAIN=.yourdomain.com
# CERTBOT_EMAIL=admin@yourdomain.com
# MINIO_BROWSER_REDIRECT_URL=https://minio.yourdomain.com


# ============================================================================
# 13. OPTIONAL SERVICES [OPTIONAL]
# ============================================================================
# Control which Docker services start. Set to false to save resources
# when using external services or memory caching.
#
# Usage: Run ./start.sh to apply these settings
# ----------------------------------------------------------------------------

# Enable PostgreSQL container (set to false when using external PostgreSQL)
# Default: true (PostgreSQL runs for first-time users)
#
# IMPORTANT: When disabled, you MUST set BOTH:
#   - DATABASE_URL for app data (see section 2)
#   - SUPERTOKENS_DATABASE_URL for auth data (see section 3)
#
# Your external PostgreSQL needs TWO databases:
#   1. App database (e.g., 'assethost') - stores projects, deployments, etc.
#   2. SuperTokens database (e.g., 'supertokens') - stores users, sessions
#
# Example:
#   ENABLE_POSTGRES=false
#   DATABASE_URL="postgresql://user:pass@external-host:5432/assethost"
#   SUPERTOKENS_DATABASE_URL="postgresql://user:pass@external-host:5432/supertokens"
#
# ENABLE_POSTGRES=true

# Enable MinIO container (set to false when using S3, GCS, Azure, or local storage)
# Default: true (MinIO runs for first-time users)
# ENABLE_MINIO=true

# Enable Redis container (set to false when using in-memory caching)
# Default: true (Redis runs for first-time users)
# ENABLE_REDIS=true

# Memory savings when disabled:
#   PostgreSQL disabled: ~256MB
#   MinIO disabled:      ~128MB
#   Redis disabled:      ~96MB
#   All disabled:        ~480MB

